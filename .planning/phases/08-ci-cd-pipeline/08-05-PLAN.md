---
phase: 08-ci-cd-pipeline
plan: 05
type: execute
wave: 3
depends_on: ["08-02", "08-03"]
files_modified:
  - .github/workflows/release.yml
  - .releaserc.json
  - package.json
autonomous: true

must_haves:
  truths:
    - "Semantic release automatically determines version bumps based on commits"
    - "Releases are tagged and published when PRs merge to main"
    - "Changelog is automatically generated from commit history"
  artifacts:
    - path: ".github/workflows/release.yml"
      provides: "Automated release workflow"
      contains: "semantic-release"
    - path: ".releaserc.json"
      provides: "Semantic release configuration"
      contains: "@semantic-release/changelog"
    - path: "package.json"
      provides: "Semantic release dependencies"
      contains: "semantic-release"
  key_links:
    - from: ".github/workflows/release.yml"
      to: "npx semantic-release"
      via: "Release automation step"
      pattern: "semantic-release"
    - from: ".releaserc.json"
      to: "package.json"
      via: "Version bump and changelog update"
      pattern: "package.json.*CHANGELOG.md"
---

<objective>
Automate release tagging and changelog generation using semantic-release.

Purpose: Eliminate manual versioning errors and automate release documentation. Semantic-release analyzes commit messages (feat:, fix:, BREAKING CHANGE:) to determine version bumps and generate changelogs.

Output: Release workflow that runs on main branch pushes, semantic-release configuration with changelog plugin, and package.json dependencies for semantic-release.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Users\lucid\OneDrive\Desktop\prompts\msw\.planning\PROJECT.md
@C:\Users\lucid\OneDrive\Desktop\prompts\msw\.planning\ROADMAP.md
@C:\Users\lucid\OneDrive\Desktop\prompts\msw\.planning\STATE.md
@C:\Users\lucid\OneDrive\Desktop\prompts\msw\.planning\phases\08-ci-cd-pipeline\08-RESEARCH.md
@C:\Users\lucid\OneDrive\Desktop\prompts\msw\package.json
</context>

<tasks>

<task type="auto">
  <name>Install semantic-release dependencies</name>
  <files>package.json</files>
  <action>
Install semantic-release and plugins:

**Run:**
```bash
npm install -D semantic-release @semantic-release/changelog @semantic-release/git
```

This installs:
- semantic-release: Core automation engine
- @semantic-release/changelog: Generates CHANGELOG.md
- @semantic-release/git: Commits changelog and package.json back to repo

Reference "Installation" section from 08-RESEARCH.md for exact packages.
  </action>
  <verify>
cat package.json | grep '"semantic-release"'
cat package.json | grep '"@semantic-release/changelog"'
cat package.json | grep '"@semantic-release/git"'
  </verify>
  <done>Semantic-release and plugins installed as devDependencies</done>
</task>

<task type="auto">
  <name>Create semantic-release configuration</name>
  <files>.releaserc.json</files>
  <action>
Create semantic-release configuration:

**File: .releaserc.json**
```json
{
  "branches": ["main", "master"],
  "plugins": [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    "@semantic-release/changelog",
    ["@semantic-release/npm", {
      "npmPublish": false
    }],
    "@semantic-release/github",
    ["@semantic-release/git", {
      "assets": ["package.json", "CHANGELOG.md"],
      "message": "chore(release): ${nextRelease.version} [skip ci]\n\n${nextRelease.notes}"
    }]
  ]
}
```

Configuration decisions:
- branches: ["main", "master"] - support both common branch names
- commit-analyzer: Determines version bump from commit messages
- release-notes-generator: Generates release notes from commits
- changelog: Creates/updates CHANGELOG.md
- npm: npmPublish: false (don't publish to npm - can be changed later if needed)
- github: Creates GitHub release with notes
- git: Commits package.json and CHANGELOG.md back to repo with [skip ci] to prevent infinite loop

Reference Semantic Release Configuration example from 08-RESEARCH.md.
  </action>
  <verify>
cat .releaserc.json | grep '"branches"'
cat .releaserc.json | grep '"npmPublish": false'
cat .releaserc.json | grep '"assets"'
  </verify>
  <done>.releaserc.json exists with correct plugin configuration</done>
</task>

<task type="auto">
  <name>Create release workflow</name>
  <files>.github/workflows/release.yml</files>
  <action>
Create GitHub Actions workflow for automated releases:

**File: .github/workflows/release.yml**
- Name: Release
- Triggers:
  - push:
      - branches: [main, master]
- Job: release (ubuntu-latest)
- Permissions:
  - contents: write (for creating releases and tags)
  - issues: write (for commenting on issues)
  - pull-requests: write (for commenting on PRs)
- Steps:
  1. Checkout code: actions/checkout@v4
     - with:
       - fetch-depth: 0 (full git history for changelog generation)
  2. Setup Node.js 20.x: actions/setup-node@v4 with cache: 'npm'
  3. Install dependencies: `npm ci`
  4. Build distribution: `npm run build`
  5. Semantic Release: `npx semantic-release`
     - env:
       - GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       - NPM_TOKEN: ${{ secrets.NPM_TOKEN }} (if publishing to npm in future)

Reference Pattern 7 from 08-RESEARCH.md for release workflow structure.

Key behaviors:
- Only runs on main/master branch pushes (after PR merges)
- Requires full git history for commit analysis
- Builds dist/ before releasing (ensures fresh build)
- Uses GITHUB_TOKEN (automatically provided by GitHub Actions)
- Uses NPM_TOKEN if npmPublish: true (configured in .releaserc.json)
  </action>
  <verify>
cat .github/workflows/release.yml | grep "Release"
cat .github/workflows/release.yml | grep "fetch-depth: 0"
cat .github/workflows/release.yml | grep "semantic-release"
cat .github/workflows/release.yml | grep "contents: write"
  </verify>
  <done>Release workflow exists with correct permissions, full git history, and semantic-release execution</done>
</task>

</tasks>

<verification>
1. Semantic-release dependencies installed
2. .releaserc.json created with changelog and git plugins
3. Release workflow created with correct permissions
4. Workflow runs only on main/master branch pushes
5. Build runs before release to ensure fresh dist/
</verification>

<success_criteria>
- Automated release process tags versions (CI-10)
- Changelog generated from commit history (CI-10)
- Releases created on GitHub with notes (CI-10)
- Version bumps follow semantic versioning based on commits (CI-10)
</success_criteria>

<output>
After completion, create `.planning/phases/08-ci-cd-pipeline/08-05-SUMMARY.md`

**Commit Message Convention:**
Semantic-release requires commit messages to follow Angular convention:
- `feat:` - New feature (minor version bump)
- `fix:` - Bug fix (patch version bump)
- `BREAKING CHANGE:` - Breaking change (major version bump)
- `chore:`, `docs:`, `test:` - No version bump

Example: `feat: add semantic release automation`

Optional: Add commitlint to enforce this convention (not included in this plan).
</output>
