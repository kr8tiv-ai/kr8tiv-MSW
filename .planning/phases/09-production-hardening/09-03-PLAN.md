---
phase: 09-production-hardening
plan: 03
type: execute
wave: 2
depends_on: ["09-01", "09-02"]
files_modified:
  - src/demo/index.ts
  - src/demo/wizard.ts
  - src/demo/prompts.ts
  - src/demo/sample-notebook.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "First-time users are guided through interactive configuration"
    - "Demo mode provides read-only access with sample notebook"
    - "Setup wizard validates NotebookLM URL format"
    - "Configuration is saved to .msw/config.yaml"
  artifacts:
    - path: "src/demo/wizard.ts"
      provides: "Interactive setup flow with Inquirer.js"
      exports: ["runSetupWizard", "SetupConfig"]
    - path: "src/demo/prompts.ts"
      provides: "Prompt definitions with validation"
      exports: ["setupPrompts", "validateNotebookUrl"]
    - path: "src/demo/sample-notebook.ts"
      provides: "Sample notebook fallback for demo mode"
      exports: ["SAMPLE_NOTEBOOK_URL", "getSampleNotebookConfig"]
    - path: "src/demo/index.ts"
      provides: "Barrel export for demo module"
      exports: ["runSetupWizard", "isFirstRun"]
  key_links:
    - from: "src/demo/wizard.ts"
      to: "inquirer"
      via: "interactive prompts"
      pattern: "import inquirer"
    - from: "src/demo/wizard.ts"
      to: ".msw/config.yaml"
      via: "configuration save"
      pattern: "config\\.yaml"
---

<objective>
Implement interactive demo mode with setup wizard for first-time users.

Purpose: Guide new users through MSW configuration with interactive prompts, provide a safe demo mode with sample notebook, and persist configuration to disk.

Output: Complete demo module (`src/demo/`) with Inquirer.js setup wizard, URL validation, and sample notebook fallback.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-production-hardening/09-RESEARCH.md
@.planning/phases/09-production-hardening/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install CLI dependencies</name>
  <files>package.json</files>
  <action>
Install production dependencies for interactive CLI:
- `inquirer` ^9.x - Interactive command-line prompts
- `chalk` ^5.x - Terminal string styling
- `ora` ^8.x - Elegant terminal spinners
- `figlet` ^1.x - ASCII art text generation

Install dev dependencies:
- `@types/inquirer` (for Inquirer.js 9.x type definitions)
- `@types/figlet`

Run: `npm install inquirer chalk ora figlet && npm install -D @types/inquirer @types/figlet`

NOTE: chalk 5.x is ESM-only. Ensure import syntax is correct.
  </action>
  <verify>
- `npm ls inquirer` shows ^9.x
- `npm ls chalk` shows ^5.x
- `npm ls ora` shows ^8.x
- `npm ls figlet` shows ^1.x
  </verify>
  <done>CLI dependencies installed for interactive setup wizard</done>
</task>

<task type="auto">
  <name>Task 2: Implement setup wizard and demo mode</name>
  <files>
    src/demo/prompts.ts
    src/demo/sample-notebook.ts
    src/demo/wizard.ts
    src/demo/index.ts
  </files>
  <action>
Create `src/demo/` directory with four files:

**src/demo/prompts.ts:**
```typescript
import type { QuestionCollection } from "inquirer";

/**
 * Validate NotebookLM URL format.
 * Expected: https://notebooklm.google.com/notebook/[id]
 */
export function validateNotebookUrl(input: string): true | string {
  const trimmed = input.trim();

  if (!trimmed) {
    return "URL is required";
  }

  // Accept both with and without /notebook/ path
  const urlPattern = /^https:\/\/notebooklm\.google\.com\/(notebook\/)?[a-zA-Z0-9_-]+$/;

  if (!urlPattern.test(trimmed)) {
    return "Invalid NotebookLM URL. Format: https://notebooklm.google.com/notebook/[id]";
  }

  return true;
}

export interface SetupAnswers {
  useDemo: boolean;
  notebookUrl: string;
  logLevel: "error" | "warn" | "info" | "debug";
  headless: boolean;
  quotaLimit: number;
}

/**
 * Inquirer prompts for setup wizard (HARD-12).
 */
export const setupPrompts: QuestionCollection<SetupAnswers> = [
  {
    type: "confirm",
    name: "useDemo",
    message: "Would you like to start with demo mode (safe, read-only)?",
    default: true,
  },
  {
    type: "input",
    name: "notebookUrl",
    message: "Enter your NotebookLM notebook URL:",
    when: (answers) => !answers.useDemo,
    validate: validateNotebookUrl,
    filter: (input: string) => input.trim(),
  },
  {
    type: "list",
    name: "logLevel",
    message: "Select logging verbosity:",
    choices: [
      { name: "Error only (quiet)", value: "error" },
      { name: "Warnings and errors", value: "warn" },
      { name: "Standard (recommended)", value: "info" },
      { name: "Debug (verbose)", value: "debug" },
    ],
    default: "info",
  },
  {
    type: "confirm",
    name: "headless",
    message: "Run browser in headless mode (no visible window)?",
    default: false, // Default to visible for first-time users
  },
  {
    type: "number",
    name: "quotaLimit",
    message: "Daily NotebookLM query limit (50 free, 500 enterprise):",
    default: 50,
    validate: (input: number) => {
      if (input < 1 || input > 1000) {
        return "Limit must be between 1 and 1000";
      }
      return true;
    },
  },
];
```

**src/demo/sample-notebook.ts:**
```typescript
/**
 * Sample notebook URL for demo mode (HARD-11).
 * This is a public, read-only notebook for testing MSW functionality.
 */
export const SAMPLE_NOTEBOOK_URL = "https://notebooklm.google.com/notebook/msw-demo-sample";

/**
 * Demo mode configuration.
 */
export interface DemoConfig {
  notebookUrl: string;
  isDemo: true;
  readOnly: true;
  features: string[];
}

/**
 * Get sample notebook configuration for demo mode.
 */
export function getSampleNotebookConfig(): DemoConfig {
  return {
    notebookUrl: SAMPLE_NOTEBOOK_URL,
    isDemo: true,
    readOnly: true,
    features: [
      "Topic detection and extraction",
      "Response parsing and formatting",
      "Rate limiting dashboard",
      "Structured logging",
    ],
  };
}

/**
 * Check if running in demo mode based on config.
 */
export function isDemoMode(notebookUrl: string): boolean {
  return notebookUrl === SAMPLE_NOTEBOOK_URL;
}
```

**src/demo/wizard.ts:**
```typescript
import inquirer from "inquirer";
import chalk from "chalk";
import ora from "ora";
import figlet from "figlet";
import { writeFileSync, existsSync, mkdirSync } from "node:fs";
import { join, dirname } from "node:path";
import { setupPrompts, type SetupAnswers } from "./prompts.js";
import { SAMPLE_NOTEBOOK_URL, getSampleNotebookConfig } from "./sample-notebook.js";

export interface SetupConfig {
  notebook: {
    url: string;
    isDemo: boolean;
  };
  logging: {
    level: string;
  };
  browser: {
    headless: boolean;
  };
  quota: {
    limit: number;
  };
  createdAt: string;
}

/**
 * Run the interactive setup wizard (HARD-12).
 */
export async function runSetupWizard(basePath: string = process.cwd()): Promise<SetupConfig> {
  // Display welcome banner
  displayWelcomeBanner();

  // Run interactive prompts
  const answers = await inquirer.prompt<SetupAnswers>(setupPrompts);

  // Build configuration
  const config = buildConfig(answers);

  // Save configuration with spinner
  const spinner = ora("Saving configuration...").start();

  try {
    await saveConfiguration(config, basePath);
    spinner.succeed(chalk.green("Configuration saved to .msw/config.yaml"));
  } catch (error) {
    spinner.fail(chalk.red("Failed to save configuration"));
    throw error;
  }

  // Display demo mode info if applicable
  if (config.notebook.isDemo) {
    displayDemoModeInfo();
  }

  console.log("");
  console.log(chalk.green("Setup complete! Run `msw start` to begin."));
  console.log("");

  return config;
}

function displayWelcomeBanner(): void {
  console.log("");
  console.log(
    chalk.cyan(
      figlet.textSync("MSW Protocol", { horizontalLayout: "default" })
    )
  );
  console.log(chalk.gray("  Make Shit Work - NotebookLM Integration"));
  console.log(chalk.gray("  Zero manual copy-paste between NotebookLM and coding agents"));
  console.log("");
}

function displayDemoModeInfo(): void {
  console.log("");
  console.log(chalk.yellow("=== Demo Mode ==="));
  console.log(chalk.gray("You are running in demo mode with a sample notebook."));
  console.log(chalk.gray("This provides safe, read-only access to test MSW features:"));
  console.log("");

  const features = getSampleNotebookConfig().features;
  for (const feature of features) {
    console.log(chalk.gray(`  - ${feature}`));
  }

  console.log("");
  console.log(chalk.gray("To use your own notebook, run `msw setup` again."));
}

function buildConfig(answers: SetupAnswers): SetupConfig {
  const isDemo = answers.useDemo;

  return {
    notebook: {
      url: isDemo ? SAMPLE_NOTEBOOK_URL : answers.notebookUrl,
      isDemo,
    },
    logging: {
      level: answers.logLevel,
    },
    browser: {
      headless: answers.headless,
    },
    quota: {
      limit: answers.quotaLimit,
    },
    createdAt: new Date().toISOString(),
  };
}

async function saveConfiguration(config: SetupConfig, basePath: string): Promise<void> {
  const configPath = join(basePath, ".msw/config.yaml");
  const dir = dirname(configPath);

  if (!existsSync(dir)) {
    mkdirSync(dir, { recursive: true });
  }

  // Convert to YAML format manually (avoid yaml dependency for now)
  const yaml = configToYaml(config);
  writeFileSync(configPath, yaml, "utf-8");
}

function configToYaml(config: SetupConfig): string {
  return `# MSW Protocol Configuration
# Generated by setup wizard

notebook:
  url: "${config.notebook.url}"
  isDemo: ${config.notebook.isDemo}

logging:
  level: "${config.logging.level}"

browser:
  headless: ${config.browser.headless}

quota:
  limit: ${config.quota.limit}

# Metadata
createdAt: "${config.createdAt}"
`;
}
```

**src/demo/index.ts:**
```typescript
import { existsSync } from "node:fs";
import { join } from "node:path";

// Barrel export for demo module
export { runSetupWizard, type SetupConfig } from "./wizard.js";
export { setupPrompts, validateNotebookUrl, type SetupAnswers } from "./prompts.js";
export {
  SAMPLE_NOTEBOOK_URL,
  getSampleNotebookConfig,
  isDemoMode,
  type DemoConfig,
} from "./sample-notebook.js";

/**
 * Check if this is the first run (no config exists).
 */
export function isFirstRun(basePath: string = process.cwd()): boolean {
  const configPath = join(basePath, ".msw/config.yaml");
  return !existsSync(configPath);
}

/**
 * Check if MSW is configured and ready.
 */
export function isConfigured(basePath: string = process.cwd()): boolean {
  return !isFirstRun(basePath);
}
```
  </action>
  <verify>
- `npx tsc --noEmit` passes
- `ls src/demo/` shows 4 files
- Test: Run `node --loader ts-node/esm -e "import { isFirstRun } from './src/demo/index.js'; console.log(isFirstRun());"` - should return true if no config exists
  </verify>
  <done>
- Setup wizard guides users through configuration with interactive prompts
- Demo mode provides sample notebook URL for safe testing
- NotebookLM URL validation ensures correct format
- Configuration saved to .msw/config.yaml
  </done>
</task>

</tasks>

<verification>
After completion:
1. Run `npx tsc --noEmit` - should pass without errors
2. Test wizard manually: Run the wizard script and verify prompts appear
3. Verify .msw/config.yaml is created with correct YAML format
4. Test validation: Enter invalid NotebookLM URL and verify error message
</verification>

<success_criteria>
- inquirer, chalk, ora, figlet installed in package.json
- src/demo/ module exports runSetupWizard, isFirstRun
- Interactive prompts collect notebook URL, log level, headless preference
- Demo mode option provides sample notebook fallback
- Configuration saved to .msw/config.yaml in YAML format
- URL validation rejects invalid NotebookLM URLs
</success_criteria>

<output>
After completion, create `.planning/phases/09-production-hardening/09-03-SUMMARY.md`
</output>
