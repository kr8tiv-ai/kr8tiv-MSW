---
phase: 05-gsd-ralph-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/planning.ts
  - src/planning/state-manager.ts
autonomous: true

must_haves:
  truths:
    - "GSD state files (STATE.md, ROADMAP.md, PROJECT.md) can be read and written programmatically"
    - "State updates preserve existing content and only modify specified fields"
  artifacts:
    - path: "src/types/planning.ts"
      provides: "GsdState, GsdRoadmap, GsdProject interfaces"
      exports: ["GsdState", "GsdRoadmap", "GsdProject", "IterationRecord"]
    - path: "src/planning/state-manager.ts"
      provides: "Read/write STATE.md with frontmatter, update iteration history"
      exports: ["readState", "updateState", "initState"]
  key_links:
    - from: "src/planning/state-manager.ts"
      to: "gray-matter"
      via: "import"
      pattern: "import matter from 'gray-matter'"
---

<objective>
Create the GSD state persistence layer -- types and state-manager that read/write STATE.md, ROADMAP.md, PROJECT.md with frontmatter metadata.

Purpose: Foundation for all GSD integration. Other plans need to read/write planning state.
Output: Types + state-manager module with read/write/init functions.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-gsd-ralph-integration/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Planning types and state manager</name>
  <files>src/types/planning.ts, src/planning/state-manager.ts</files>
  <action>
  Create `src/types/planning.ts` with interfaces:
  - `GsdState`: currentPhase, status, lastUpdated, decisions (Record<string,string>), blockers (string[]), iterationHistory (IterationRecord[])
  - `IterationRecord`: iteration, timestamp, phase, planId, result ('success'|'failure'), error?
  - `GsdRoadmap`: phases array with name, goal, status, plans
  - `GsdProject`: name, description, constraints, decisions

  Create `src/planning/state-manager.ts` with functions:
  - `readState(projectDir: string): GsdState` -- reads `.planning/STATE.md`, parses frontmatter via gray-matter
  - `updateState(projectDir: string, updates: Partial<GsdState>): void` -- merges updates into existing state, writes back
  - `initState(projectDir: string, config: { name: string }): void` -- creates `.planning/STATE.md` if not exists with default frontmatter
  - `addIterationRecord(projectDir: string, record: IterationRecord): void` -- appends to iterationHistory array in state

  Use `gray-matter` for frontmatter parsing (already in project). Use `fs` sync methods for simplicity. Ensure `mkdirSync` with recursive for `.planning/` dir creation.
  </action>
  <verify>
  `npx tsc --noEmit src/types/planning.ts src/planning/state-manager.ts` compiles without errors.
  </verify>
  <done>Types export all interfaces. State manager reads/writes STATE.md with frontmatter preservation. initState creates directory and file if missing.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes for both files
- Manual: `initState('/tmp/test', { name: 'test' })` creates `.planning/STATE.md` with valid frontmatter
</verification>

<success_criteria>
GSD state files can be created, read, and updated programmatically with type safety.
</success_criteria>

<output>
After completion, create `.planning/phases/05-gsd-ralph-integration/05-01-SUMMARY.md`
</output>
