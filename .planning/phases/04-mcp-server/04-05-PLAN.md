---
phase: 04-mcp-server
plan: 05
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/mcp/tools/msw-plan.ts
  - src/mcp/tools/msw-execute.ts
autonomous: true

must_haves:
  truths:
    - "msw_plan generates a PRD from research findings as a long-running job"
    - "msw_execute runs the Ralph loop as a long-running job"
  artifacts:
    - path: "src/mcp/tools/msw-plan.ts"
      provides: "msw_plan tool registrar"
      exports: ["registerMswPlan"]
    - path: "src/mcp/tools/msw-execute.ts"
      provides: "msw_execute tool registrar"
      exports: ["registerMswExecute"]
  key_links:
    - from: "src/mcp/tools/msw-plan.ts"
      to: "src/mcp/jobs/job-manager.ts"
      via: "creates and updates jobs"
      pattern: "jobManager"
    - from: "src/mcp/tools/msw-execute.ts"
      to: "src/mcp/jobs/job-manager.ts"
      via: "creates and updates jobs"
      pattern: "jobManager"
---

<objective>
Implement msw_plan (MCP-04) and msw_execute (MCP-05) tools.

Purpose: msw_plan generates a PRD from NotebookLM research findings. msw_execute runs the Ralph loop with NotebookLM feedback. Both are long-running and return job IDs.
Output: Two tool registrars following the same job ID pattern as msw_research.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-mcp-server/04-RESEARCH.md
@.planning/phases/04-mcp-server/04-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: msw_plan tool</name>
  <files>src/mcp/tools/msw-plan.ts</files>
  <action>
    Create `src/mcp/tools/msw-plan.ts` exporting `registerMswPlan(server: McpServer)`:

    Register tool "msw_plan" with description "Generate PRD from research findings (long-running, returns job ID)".

    Zod input schema:
    - projectDir: z.string().describe("Project directory with .msw/ config and research data")
    - researchJobId: z.string().optional().describe("Job ID of completed research to use")
    - outputPath: z.string().optional().describe("Path for generated PRD (default: .msw/PRD.md)")

    Handler:
    1. Validate .msw/ exists
    2. If researchJobId given, verify it's completed via jobManager
    3. Create job, return job ID immediately
    4. Background: read research data from .msw/research/, compile into PRD format, write to outputPath
    5. Stub the actual PRD generation logic (Phase 5 dependency) with a placeholder that reads research files and produces a basic markdown summary
  </action>
  <verify>`npx tsc --noEmit src/mcp/tools/msw-plan.ts`</verify>
  <done>msw_plan creates background job that generates PRD from research data</done>
</task>

<task type="auto">
  <name>Task 2: msw_execute tool</name>
  <files>src/mcp/tools/msw-execute.ts</files>
  <action>
    Create `src/mcp/tools/msw-execute.ts` exporting `registerMswExecute(server: McpServer)`:

    Register tool "msw_execute" with description "Run Ralph execution loop with NotebookLM feedback (long-running, returns job ID)".

    Zod input schema:
    - projectDir: z.string().describe("Project directory with .msw/ config")
    - taskDescription: z.string().describe("What to implement")
    - maxIterations: z.number().optional().default(5).describe("Maximum Ralph loop iterations")

    Handler:
    1. Validate .msw/ exists
    2. Create job, return job ID immediately
    3. Background: stub the Ralph loop (Phase 5 dependency) â€” create a placeholder that:
       - Updates progress on each "iteration" (simple loop with delays for now)
       - Writes iteration logs to .msw/execution/
       - Completes with a summary of iterations run
    4. On error: mark job failed
  </action>
  <verify>`npx tsc --noEmit src/mcp/tools/msw-execute.ts`</verify>
  <done>msw_execute creates background job running (stubbed) Ralph loop</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Both tools return job IDs and run background operations
</verification>

<success_criteria>
msw_plan and msw_execute tools are registered, return job IDs, and have stubs ready for Phase 5 engine integration.
</success_criteria>

<output>
After completion, create `.planning/phases/04-mcp-server/04-05-SUMMARY.md`
</output>
