---
phase: 04-mcp-server
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - src/mcp/tools/msw-init.ts
  - src/mcp/tools/msw-status.ts
autonomous: true

must_haves:
  truths:
    - "msw_init creates .msw/ directory structure in a project"
    - "msw_status returns overall state and individual job status"
  artifacts:
    - path: "src/mcp/tools/msw-init.ts"
      provides: "msw_init tool registrar"
      exports: ["registerMswInit"]
    - path: "src/mcp/tools/msw-status.ts"
      provides: "msw_status tool registrar"
      exports: ["registerMswStatus"]
  key_links:
    - from: "src/mcp/tools/msw-status.ts"
      to: "src/mcp/jobs/job-manager.ts"
      via: "queries job manager for status"
      pattern: "jobManager\\.get|jobManager\\.list"
---

<objective>
Implement msw_init (MCP-02) and msw_status (MCP-07) tools.

Purpose: msw_init bootstraps the .msw/ directory for a project. msw_status provides the polling mechanism for long-running jobs and overall system state.
Output: Two tool registrars that can be passed to registerTools().
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-mcp-server/04-RESEARCH.md
@.planning/phases/04-mcp-server/04-01-SUMMARY.md
@.planning/phases/04-mcp-server/04-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: msw_init tool</name>
  <files>src/mcp/tools/msw-init.ts</files>
  <action>
    Create `src/mcp/tools/msw-init.ts` exporting `registerMswInit(server: McpServer)`:

    Register tool "msw_init" with description "Initialize MSW protocol for a project directory".

    Zod input schema:
    - projectDir: z.string().describe("Absolute path to the project directory")
    - notebookUrls: z.array(z.string()).optional().describe("NotebookLM notebook URLs to associate")

    Handler logic:
    1. Create `{projectDir}/.msw/` directory if not exists
    2. Create `{projectDir}/.msw/config.json` with: { initialized: ISO date, notebookUrls: [], version: "0.1.0" }
    3. Create `{projectDir}/.msw/research/` directory
    4. If notebookUrls provided, save them to config
    5. Return success with config summary

    Use `fs.mkdirSync` with `{ recursive: true }`. Use `fs.writeFileSync` for config.
    Wrap in try/catch, return `isError: true` on failure.
  </action>
  <verify>`npx tsc --noEmit src/mcp/tools/msw-init.ts`</verify>
  <done>msw_init creates .msw/ directory structure and config.json in target project</done>
</task>

<task type="auto">
  <name>Task 2: msw_status tool</name>
  <files>src/mcp/tools/msw-status.ts</files>
  <action>
    Create `src/mcp/tools/msw-status.ts` exporting `registerMswStatus(server: McpServer)`:

    Register tool "msw_status" with description "Check MSW status and poll long-running jobs".

    Zod input schema:
    - jobId: z.string().optional().describe("Specific job ID to check (omit for overall status)")
    - projectDir: z.string().optional().describe("Project directory to check .msw/ state")

    Handler logic:
    1. If jobId provided: return job details from JobManager (get by ID), return error if not found
    2. If projectDir provided: read .msw/config.json and return project state
    3. If neither: return list of all jobs from JobManager

    Import jobManager singleton from jobs/job-manager.
    Return JSON stringified results in text content.
  </action>
  <verify>`npx tsc --noEmit src/mcp/tools/msw-status.ts`</verify>
  <done>msw_status polls individual jobs and reports overall MSW state</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Both files export registrar functions with correct signatures
</verification>

<success_criteria>
msw_init creates project structure, msw_status provides job polling and state reporting.
</success_criteria>

<output>
After completion, create `.planning/phases/04-mcp-server/04-03-SUMMARY.md`
</output>
