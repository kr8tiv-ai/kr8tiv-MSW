---
phase: 04-mcp-server
plan: 08
type: execute
wave: 4
depends_on: ["04-07"]
files_modified:
  - src/mcp/index.ts
  - package.json
autonomous: false

must_haves:
  truths:
    - "Server works when configured in Claude Code MCP settings"
    - "Server works when configured in Cursor MCP settings"
    - "Server works when configured in Windsurf MCP settings"
    - "Client config examples are documented in code comments"
  artifacts:
    - path: "src/mcp/index.ts"
      provides: "Entry point with client config documentation in comments"
      contains: "mcpServers"
    - path: "package.json"
      provides: "bin entry for msw-mcp-server"
      contains: "msw-mcp-server"
  key_links:
    - from: "package.json bin"
      to: "dist/mcp/index.js"
      via: "bin entry resolves to compiled entry point"
      pattern: "msw-mcp-server.*dist/mcp/index.js"
---

<objective>
Test multi-client compatibility with Claude Code, Windsurf, and Cursor (MCP-10).

Purpose: The MCP server must work identically across all three target clients. This plan validates config formats and runtime behavior.
Output: Verified compatibility with all three clients, documented config examples.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-mcp-server/04-RESEARCH.md
@.planning/phases/04-mcp-server/04-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prepare client configs and harden entry point</name>
  <files>src/mcp/index.ts, package.json</files>
  <action>
    Update `src/mcp/index.ts`:
    1. Add detailed JSDoc comment block at top with client config examples for all three clients:
       - Claude Code: `.claude/mcp.json` format
       - Cursor: `~/.cursor/mcp.json` format
       - Windsurf: `~/.codeium/windsurf/mcp_config.json` format
    2. Add robust error handling: catch uncaught exceptions and unhandled rejections, log to stderr, exit cleanly
    3. Add process.on('SIGINT') and process.on('SIGTERM') for clean shutdown

    Verify package.json has bin entry pointing to `./dist/mcp/index.js`.

    Run `npm run build` to ensure dist/ is up to date.
  </action>
  <verify>`npm run build` succeeds, `node dist/mcp/index.js` starts cleanly</verify>
  <done>Entry point is hardened with signal handlers and documented with client configs</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete MCP server with 7 tools, job management, and multi-client config documentation</what-built>
  <how-to-verify>
    1. Add to Claude Code config (`.claude/mcp.json`):
       ```json
       { "mcpServers": { "msw": { "command": "node", "args": ["C:/path/to/msw-protocol/dist/mcp/index.js"] } } }
       ```
    2. Restart Claude Code, verify MSW tools appear (msw_init, msw_status, msw_research, msw_plan, msw_execute, msw_verify, msw_notebook_add)
    3. Call msw_init with a test project directory
    4. Call msw_research — verify job ID returned
    5. Call msw_status with that job ID — verify status response
    6. (Optional) Repeat with Cursor and/or Windsurf if available
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. Server starts via `node dist/mcp/index.js` without errors
2. All 7 tools discoverable by at least one MCP client
3. Tool calls return expected responses
4. No stdout pollution (all logs on stderr)
</verification>

<success_criteria>
MCP server works with Claude Code (and ideally Cursor/Windsurf), all tools callable, job polling functional.
</success_criteria>

<output>
After completion, create `.planning/phases/04-mcp-server/04-08-SUMMARY.md`
</output>
