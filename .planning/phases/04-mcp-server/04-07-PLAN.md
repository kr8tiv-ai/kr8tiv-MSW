---
phase: 04-mcp-server
plan: 07
type: execute
wave: 3
depends_on: ["04-01", "04-02", "04-03", "04-04", "04-05", "04-06"]
files_modified:
  - src/mcp/server.ts
  - src/mcp/index.ts
autonomous: true

must_haves:
  truths:
    - "All 7 tools are registered and appear in tools/list response"
    - "Server entry point wires all tool registrars together"
    - "Long-running tools return job IDs that msw_status can poll"
  artifacts:
    - path: "src/mcp/server.ts"
      provides: "Server creation with all tools registered"
      contains: "registerTools"
    - path: "src/mcp/index.ts"
      provides: "Complete entry point"
      contains: "createServer"
  key_links:
    - from: "src/mcp/index.ts"
      to: "src/mcp/tools/*.ts"
      via: "registerTools wires all registrars"
      pattern: "registerMsw"
    - from: "src/mcp/tools/msw-status.ts"
      to: "src/mcp/jobs/job-manager.ts"
      via: "polls job state created by research/plan/execute"
      pattern: "jobManager"
---

<objective>
Wire all tools into the server and verify the complete tool discovery flow.

Purpose: Integrates all 7 tools (init, status, research, plan, execute, verify, notebook_add) into the MCP server so they appear in tools/list and can be called.
Output: Fully wired server with all tools registered.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-mcp-server/04-01-SUMMARY.md
@.planning/phases/04-mcp-server/04-02-SUMMARY.md
@.planning/phases/04-mcp-server/04-03-SUMMARY.md
@.planning/phases/04-mcp-server/04-04-SUMMARY.md
@.planning/phases/04-mcp-server/04-05-SUMMARY.md
@.planning/phases/04-mcp-server/04-06-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire all tools into server</name>
  <files>src/mcp/server.ts, src/mcp/index.ts</files>
  <action>
    Update `src/mcp/server.ts`:
    1. Import all tool registrars: registerMswInit, registerMswStatus, registerMswResearch, registerMswPlan, registerMswExecute, registerMswVerify, registerMswNotebookAdd
    2. Import registerTools from tools/registry
    3. In createServer(), after creating McpServer, call registerTools with all 7 registrars
    4. Return the fully configured server

    Update `src/mcp/index.ts` if needed to ensure clean startup with all tools.
  </action>
  <verify>
    Build with `npm run build`. Start server with `node dist/mcp/index.js`.
    Send a tools/list JSON-RPC request on stdin and verify 7 tools appear in response.
    Alternatively: use `npx @modelcontextprotocol/inspector` to verify tool listing.
  </verify>
  <done>All 7 MSW tools appear in MCP tools/list response</done>
</task>

<task type="auto">
  <name>Task 2: Verify job ID flow end-to-end</name>
  <files>src/mcp/index.ts</files>
  <action>
    Create a simple smoke test script (can be inline in verify step):
    1. Start the MCP server process
    2. Send msw_init call with a temp directory
    3. Send msw_research call — verify it returns a jobId
    4. Send msw_status with that jobId — verify it returns job state
    5. Send msw_notebook_add to add a URL
    6. Clean up temp directory

    This can be a manual verification or a small Node script. The key is proving the job ID polling loop works across tool boundaries.

    Also add a barrel export: `src/mcp/tools/index.ts` re-exporting all registrars for clean imports.
  </action>
  <verify>Smoke test demonstrates: init -> research (returns jobId) -> status (returns job state) -> notebook_add (updates config)</verify>
  <done>End-to-end job ID flow works: create job via research, poll via status</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. Server starts and lists 7 tools
3. Job ID flow works across tool boundaries
</verification>

<success_criteria>
Complete MCP server with all tools registered, discoverable, and callable.
</success_criteria>

<output>
After completion, create `.planning/phases/04-mcp-server/04-07-SUMMARY.md`
</output>
