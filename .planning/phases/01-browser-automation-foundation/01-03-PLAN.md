---
phase: 01-browser-automation-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified:
  - src/browser/driver.ts
  - src/notebooklm/navigator.ts
autonomous: true

must_haves:
  truths:
    - "BrowserDriver uses ProfileManager for profile directory and locking"
    - "Navigator can open a NotebookLM URL and detect whether authentication is needed"
    - "Navigator waits for chat interface readiness before returning"
  artifacts:
    - path: "src/notebooklm/navigator.ts"
      provides: "NotebookLM connection and authentication detection"
      exports: ["NotebookNavigator"]
  key_links:
    - from: "src/browser/driver.ts"
      to: "src/browser/profile.ts"
      via: "import ProfileManager, used in launch()"
      pattern: "ProfileManager"
    - from: "src/notebooklm/navigator.ts"
      to: "src/browser/driver.ts"
      via: "receives Page from BrowserDriver"
      pattern: "Page"
---

<objective>
Wire BrowserDriver to ProfileManager and implement the NotebookLM navigator that connects to a notebook URL and verifies the UI is ready for interaction.

Purpose: This connects the browser foundation (plan 01) with profile persistence (plan 02) and adds NotebookLM-specific navigation logic.
Output: NotebookNavigator class that opens a notebook and confirms readiness.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-browser-automation-foundation/01-RESEARCH.md
@.planning/phases/01-browser-automation-foundation/01-01-SUMMARY.md
@.planning/phases/01-browser-automation-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate ProfileManager into BrowserDriver</name>
  <files>src/browser/driver.ts</files>
  <action>
  Update BrowserDriver.launch() to:
  1. Create ProfileManager instance (use config.profileDir or default)
  2. Call `profileManager.getProfileDir()` to ensure directory + acquire lock
  3. Pass the returned profileDir to `launchPersistentContext()`
  4. On `close()`, call `profileManager.releaseLock()`

  This replaces any direct fs.mkdirSync calls in driver.ts with ProfileManager delegation.
  </action>
  <verify>`npx tsc --noEmit` passes. BrowserDriver imports and uses ProfileManager.</verify>
  <done>BrowserDriver delegates profile management to ProfileManager, lock acquired on launch, released on close</done>
</task>

<task type="auto">
  <name>Task 2: Implement NotebookNavigator</name>
  <files>src/notebooklm/navigator.ts</files>
  <action>
  Export `NotebookNavigator` class:

  **Constructor:** Takes a Playwright `Page` instance.

  **`async connect(notebookUrl: string)`:**
  1. Navigate: `page.goto(notebookUrl, { waitUntil: 'domcontentloaded' })`
  2. Auth check: Look for sign-in indicator using `page.getByRole('button', { name: /sign in/i }).isVisible({ timeout: 5000 }).catch(() => false)`
  3. If auth needed: throw `Error('NotebookLM requires authentication. Please run MSW once with a visible browser to log in manually, then restart.')`
  4. Wait for chat readiness: `page.getByRole('textbox', { name: /ask|type/i }).waitFor({ state: 'visible', timeout: 30000 })`
  5. Return `{ connected: true, url: notebookUrl }`

  **`async isReady()`:**
  - Check if chat input textbox is visible (non-throwing, returns boolean)

  **`async getNotebookTitle()`:**
  - Try to extract notebook title from page (best-effort, return 'Unknown' on failure)

  Add `NotebookConnection` type to types/browser.ts: `{ connected: boolean, url: string, title?: string }`
  </action>
  <verify>`npx tsc --noEmit` passes. NotebookNavigator exports connect/isReady methods.</verify>
  <done>NotebookNavigator connects to a notebook URL, detects auth requirement, waits for chat readiness</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes
2. BrowserDriver uses ProfileManager (grep confirms import)
3. NotebookNavigator handles auth detection and chat readiness
</verification>

<success_criteria>
Full launch-to-connect pipeline: BrowserDriver launches with profile lock, NotebookNavigator opens a notebook URL and confirms the chat UI is ready.
</success_criteria>

<output>
After completion, create `.planning/phases/01-browser-automation-foundation/01-03-SUMMARY.md`
</output>
