---
phase: 01-browser-automation-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/browser/driver.ts
  - src/browser/stealth.ts
  - src/types/browser.ts
autonomous: true

must_haves:
  truths:
    - "Browser launches via BrowserDriver class with stealth plugins applied"
    - "Stealth configuration removes navigator.webdriver and patches headless fingerprints"
    - "TypeScript compiles without errors"
  artifacts:
    - path: "src/browser/driver.ts"
      provides: "BrowserDriver class with launch/close methods"
      exports: ["BrowserDriver"]
    - path: "src/browser/stealth.ts"
      provides: "Stealth plugin configuration"
      exports: ["configureStealthBrowser"]
    - path: "src/types/browser.ts"
      provides: "Browser-related type definitions"
      exports: ["BrowserConfig", "LaunchOptions"]
    - path: "package.json"
      provides: "Project dependencies"
      contains: "playwright-extra"
  key_links:
    - from: "src/browser/driver.ts"
      to: "src/browser/stealth.ts"
      via: "import configureStealthBrowser"
      pattern: "import.*stealth"
---

<objective>
Set up the Node.js/TypeScript project scaffold and implement the core Playwright browser driver with stealth plugin integration.

Purpose: This is the foundation everything else builds on — a launchable stealth browser.
Output: Working BrowserDriver class that launches Playwright with stealth evasion.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-browser-automation-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Node.js/TypeScript project with dependencies</name>
  <files>package.json, tsconfig.json</files>
  <action>
  Initialize npm project if package.json doesn't exist. Install dependencies:
  ```bash
  npm init -y
  npm install playwright-extra puppeteer-extra-plugin-stealth playwright
  npm install -D typescript @types/node
  npx playwright install chromium
  ```

  Create tsconfig.json with:
  - target: ES2022, module: Node16, moduleResolution: Node16
  - outDir: dist/, rootDir: src/
  - strict: true, esModuleInterop: true
  - declaration: true

  Create directory structure: src/browser/, src/notebooklm/, src/types/
  </action>
  <verify>
  `npx tsc --noEmit` runs without errors (empty project).
  `node -e "require('playwright-extra')"` succeeds.
  </verify>
  <done>package.json has all 3 runtime deps, tsconfig.json compiles, directory structure exists</done>
</task>

<task type="auto">
  <name>Task 2: Implement BrowserDriver and stealth configuration</name>
  <files>src/types/browser.ts, src/browser/stealth.ts, src/browser/driver.ts</files>
  <action>
  **src/types/browser.ts:** Define types:
  - `BrowserConfig`: { profileDir: string, headless: boolean, viewport: { width: number, height: number }, userAgent?: string }
  - `LaunchOptions`: extends BrowserConfig with optional args: string[]

  **src/browser/stealth.ts:** Export `configureStealthBrowser()`:
  - Import `chromium` from `playwright-extra`
  - Import `StealthPlugin` from `puppeteer-extra-plugin-stealth`
  - Apply `chromium.use(StealthPlugin())`
  - Return the configured chromium instance
  - IMPORTANT: Call `chromium.use()` only once (guard with a module-level flag)

  **src/browser/driver.ts:** Export `BrowserDriver` class:
  - Constructor takes `BrowserConfig` (default profileDir: `~/.msw/chrome-profile/`)
  - `async launch()`: calls `configureStealthBrowser()`, then `chromium.launchPersistentContext(profileDir, opts)` with:
    - headless: false (hardcoded — Google detects headless)
    - args: ['--disable-blink-features=AutomationControlled', '--no-first-run', '--no-default-browser-check']
    - viewport from config (default 1280x900)
    - userAgent: explicit Chrome UA string (do NOT rely on stealth to set it — known bug with persistent contexts)
    - ignoreDefaultArgs: ['--enable-automation']
  - `async getPage()`: returns `context.pages()[0] || await context.newPage()`
  - `async close()`: closes context gracefully
  - `isLaunched()`: boolean getter
  - Ensure profileDir is created with `fs.mkdirSync(recursive: true)` before launch
  </action>
  <verify>
  `npx tsc --noEmit` passes.
  Write a quick test script: `node -e "const {BrowserDriver} = require('./dist/browser/driver'); console.log('OK')"` after `npx tsc`.
  </verify>
  <done>BrowserDriver class compiles, exports launch/close/getPage, stealth is applied before launch, types are defined</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. All three source files exist and export their documented symbols
3. package.json contains playwright-extra, puppeteer-extra-plugin-stealth, playwright as dependencies
</verification>

<success_criteria>
Project scaffold complete. BrowserDriver can be instantiated and launch() method signature is correct. TypeScript compiles cleanly. Stealth plugin is configured.
</success_criteria>

<output>
After completion, create `.planning/phases/01-browser-automation-foundation/01-01-SUMMARY.md`
</output>
