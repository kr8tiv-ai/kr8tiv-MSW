---
phase: 06-end-to-end-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/mcp/tools/msw-research.ts
  - src/mcp/tools/msw-execute.ts
  - src/mcp/tools/msw-verify.ts
  - src/mcp/tools/msw-plan.ts
autonomous: true

must_haves:
  truths:
    - "msw_research tool launches browser, navigates to NotebookLM, runs TopicExpansionEngine, and returns real results"
    - "msw_execute tool triggers Ralph runner with real iteration tracking"
    - "msw_verify tool runs behavioral verifier against actual project state"
    - "msw_plan tool uses PrdGenerator with real research data"
  artifacts:
    - path: "src/mcp/tools/msw-research.ts"
      provides: "Wired research tool with BrowserDriver -> Navigator -> Engine pipeline"
      contains: "BrowserDriver"
    - path: "src/mcp/tools/msw-execute.ts"
      provides: "Wired execute tool with Ralph runner"
      contains: "RalphRunner"
    - path: "src/mcp/tools/msw-verify.ts"
      provides: "Wired verify tool with behavioral verifier"
      contains: "BehavioralVerifier"
    - path: "src/mcp/tools/msw-plan.ts"
      provides: "Wired plan tool with PRD generator"
      contains: "PrdGenerator"
  key_links:
    - from: "src/mcp/tools/msw-research.ts"
      to: "src/browser/driver.ts"
      via: "import and instantiate BrowserDriver"
      pattern: "BrowserDriver"
    - from: "src/mcp/tools/msw-research.ts"
      to: "src/auto-conversation/engine.ts"
      via: "TopicExpansionEngine with real page"
      pattern: "TopicExpansionEngine"
---

<objective>
Wire all MCP tool handlers to real engine implementations, replacing stubs with actual browser orchestration, auto-conversation, planning, execution, and verification pipelines.

Purpose: The MCP tools currently have stubs that report "engine available but not wired." This plan connects them to the real implementations built in Phases 1-5.
Output: All 7 MCP tools call real underlying engines when invoked.
</objective>

<execution_context>
@C:\Users\lucid\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lucid\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/mcp/tools/msw-research.ts
@src/mcp/tools/msw-execute.ts
@src/mcp/tools/msw-verify.ts
@src/mcp/tools/msw-plan.ts
@src/mcp/server.ts
@src/browser/driver.ts
@src/notebooklm/navigator.ts
@src/auto-conversation/engine.ts
@src/execution/feedback-injector.ts
@src/execution/behavioral-verifier.ts
@src/planning/prd-generator.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire msw_research and msw_plan to real engines</name>
  <files>src/mcp/tools/msw-research.ts, src/mcp/tools/msw-plan.ts</files>
  <action>
In msw-research.ts, replace the stub `runResearchJob` with real orchestration:
1. Import BrowserDriver from `../../browser/driver.js`
2. Import NotebookLMNavigator from `../../notebooklm/navigator.js`
3. Import TopicExpansionEngine from `../../auto-conversation/engine.js`
4. Import QueryInjector from `../../bidirectional/query-injector.js`
5. In runResearchJob:
   - Read .msw/config.json to get notebookUrls
   - Create BrowserDriver, call launch()
   - Create NotebookLMNavigator with the page, navigate to notebook URL
   - Create TopicExpansionEngine with the page and options (maxQueries, relevanceThreshold)
   - Run the engine, collect results
   - On completion, use ReportCompiler from knowledge module to persist results to .msw/research/
   - Close browser in finally block
   - Update job with real results (topic count, Q&A pairs extracted)
6. Keep the try/catch with graceful fallback if engines fail to import (backwards compat)

In msw-plan.ts, replace the stub PRD generation (Step 3):
1. Import PrdGenerator from `../../planning/prd-generator.js`
2. Instead of string-template PRD, call PrdGenerator.generate() with the compiled research sections
3. Write the generated PRD to prdPath
  </action>
  <verify>Run `npm run check` (tsc --noEmit) to confirm no type errors in modified files.</verify>
  <done>msw_research creates real browser session and runs TopicExpansionEngine; msw_plan uses PrdGenerator for real PRD output.</done>
</task>

<task type="auto">
  <name>Task 2: Wire msw_execute and msw_verify to real engines</name>
  <files>src/mcp/tools/msw-execute.ts, src/mcp/tools/msw-verify.ts</files>
  <action>
In msw-execute.ts:
1. Import RalphRunner or equivalent from `../../execution/iteration-tracker.js` and `../../execution/feedback-injector.js`
2. Replace any stub execution logic with real Ralph loop:
   - Initialize IterationTracker with maxIterations from args
   - On each iteration failure, use FeedbackInjector to query NotebookLM via the bidirectional pipeline
   - Use CompletionDetector from `../../execution/completion-detector.js` to check if done
   - Update job progress on each iteration
3. Keep graceful degradation if browser unavailable (report what would happen)

In msw-verify.ts:
1. Import BehavioralVerifier from `../../execution/behavioral-verifier.js`
2. Replace any stub with real verification:
   - Read verification criteria from .msw/ or from tool arguments
   - Run BehavioralVerifier.verify() against actual project state
   - Return structured pass/fail results with details
  </action>
  <verify>Run `npm run check` to confirm no type errors.</verify>
  <done>msw_execute runs real Ralph iteration loop with feedback injection; msw_verify runs real behavioral verification.</done>
</task>

</tasks>

<verification>
- `npm run check` passes with zero errors
- All 7 MCP tool files import real engines (no more "pipeline required" stub messages)
- `npm run build` produces dist/ with wired implementations
</verification>

<success_criteria>
All MCP tool handlers call real underlying engines. The stub messages about "Full browser orchestration pipeline required" are replaced with actual orchestration code.
</success_criteria>

<output>
After completion, create `.planning/phases/06-end-to-end-integration/06-01-SUMMARY.md`
</output>
